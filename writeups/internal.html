<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Internal | TryHackMe Writeup</title>

<link rel="stylesheet" href="../css/style.css">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
</head>

<body>

<!-- NAVBAR -->
<div class="navbar">
    <div class="nav-left">
        <a href="../index.html">Home</a>
        <a href="../experience.html">Experience</a>
        <a href="index.html">Writeups</a>
    </div>

    <div class="nav-right-icons">
        <!-- Email -->
        <a href="mailto:sharprider33@gmail.com" class="icon-link">
            <svg viewBox="0 0 24 24">
                <path d="M2 4h20v16H2V4zm2 2v.511l8 5.334 8-5.334V6H4zm16 2.489l-7.386 4.924a1 1 0 01-1.228 0L4 8.489V18h16V8.489z"/>
            </svg>
        </a>

        <!-- LinkedIn -->
        <a href="https://www.linkedin.com/in/stephenmiller05/" target="_blank" class="icon-link">
            <svg viewBox="0 0 24 24">
                <path d="M4.98 3.5C4.98 4.88 3.87 6 2.49 6S0 4.88 0 3.5 1.11 1 2.49 1 4.98 2.12 4.98 3.5zM.5 8h4v16h-4V8zm7 0h3.6v2.2h.05c.5-.9 1.75-2.2 3.6-2.2 3.85 0 4.55 2.55 4.55 5.85V24h-4v-8.4c0-2-.03-4.55-2.8-4.55-2.8 0-3.25 2.2-3.25 4.4V24h-4V8z"/>
            </svg>
        </a>

        <!-- GitHub -->
        <a href="https://github.com/ProbablyMiller" target="_blank" class="icon-link">
            <svg viewBox="0 0 24 24">
                <path d="M12 0C5.37 0 0 5.37 0 12c0 5.3 3.438 9.8 8.205 11.387.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61-.547-1.387-1.336-1.757-1.336-1.757-1.09-.745.083-.729.083-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.807 1.305 3.492.997.108-.775.418-1.305.76-1.605-2.665-.305-5.466-1.332-5.466-5.93 0-1.31.467-2.38 1.236-3.22-.124-.303-.536-1.523.117-3.176 0 0 1.008-.322 3.3 1.23a11.49 11.49 0 013.003-.404c1.02.005 2.047.138 3.003.404 2.29-1.552 3.296-1.23 3.296-1.23.655 1.653.243 2.873.12 3.176.77.84 1.234 1.91 1.234 3.22 0 4.61-2.805 5.623-5.476 5.92.43.37.823 1.102.823 2.222 0 1.605-.015 2.898-.015 3.293 0 .322.216.694.825.576C20.565 21.795 24 17.297 24 12 24 5.37 18.63 0 12 0z"/>
            </svg>
        </a>
    </div>
</div>

<!-- WRITEUP CONTENT -->
<div class="writeup-container">

<h1>Internal ‚Äî TryHackMe Writeup</h1>
<p class="writeup-meta">Author: Stephen Miller (ProbablyMiller)</p>
<p class="writeup-meta">Platform: TryHackMe ‚Ä¢ Difficulty: Hard</p>

<hr class="divider">

<!-- START WRITEUP -->
    
<p>This will be my first ‚ÄúHard‚Äù CTF, so let's get to it!</p>

    <p>Quick note, I apologize for some of the low quality pictures. I made a mistake when capturing my screen so just bare with me here :)</p>

<p>Before anything, let's read our scope listed in the description of the CTF.</p>

<div class="terminal-block">
<a href="images/internal/it1.png" target="_blank">
<img src="images/internal/it1.png">
</a>
</div>

<p>Alrighty, pretty simple stuff. We‚Äôre just looking for our normal two flags, ‚ÄúUser‚Äù, and ‚ÄúRoot‚Äù. It states we‚Äôre allowed to use whatever tools we want, and to only use the IP address assigned to our machine. Standard issue CTF.</p>

<p>Alright, let‚Äôs load up the web page and see what we got here.</p>

<div class="terminal-block">
<a href="images/internal/it2.png" target="_blank">
<img src="images/internal/it2.png">
</a>
</div>

<p>Looks like a basic Apache2 home page. Nothing interesting shown on this page, but let‚Äôs take a look at the page source to see if there‚Äôs anything hidden or interesting.</p>

<p>As I expected, nothing interesting. Moving forwards onto enumeration!</p>

<p>Let us run a basic nmap scan to see what ports are open, and if any are vulnerable.</p>

<div class="terminal-block">
<a href="images/internal/it3.png" target="_blank">
<img src="images/internal/it3.png">
</a>
</div>

<p>Once again, nothing too interesting.</p>

<p>Alright, let‚Äôs enumerate some directories via ffuf!</p>

<div class="terminal-block">
<a href="images/internal/it4.png" target="_blank">
<img src="images/internal/it4.png">
</a>
</div>

<p>A few things here! Blog, wordpress, javascript, and phpmyadmin. Before we go to the obvious one, let‚Äôs take a look at the others and see what we have.</p>

<div class="terminal-block">
<a href="images/internal/it5.png" target="_blank">
<img src="images/internal/it5.png">
</a>
</div>

<p>Taking a look into /blog, it seems we have a basic blog post website. Note, it‚Äôs powered by WordPress. Before we try anything let‚Äôs visit the other pages.</p>

<div class="terminal-block">
<a href="images/internal/it6.png" target="_blank">
<img src="images/internal/it6.png">
</a>
</div>

<p>Alrighty, /wordpress ‚Äúcan‚Äôt be found.‚Äù I‚Äôll make note of this but for now let‚Äôs move on cause we don‚Äôt have an obvious attack surface right now.</p>

<p>No access to /javascript, who would have guessed.</p>

<p>Moving on to the obvious one, /phpmyadmin. Looks like we have a basic login portal presented to us by none other than ‚Äúphpmyadmin‚Äù... We don‚Äôt have a username or a password yet, so trying to bruteforce would be useless right now.</p>

<p>Let‚Äôs run searchsploit on phpmyadmin to see if we have any attack methods.</p>

<div class="terminal-block">
<a href="images/internal/it7.png" target="_blank">
<img src="images/internal/it7.png">
</a>
</div>

<p>Ah, quite a few. Let me check the page source to see if we can find a version.</p>

<div class="terminal-block">
<a href="images/internal/it8.png" target="_blank">
<img src="images/internal/it8.png">
</a>
</div>

<p>After running a quick CNTL + F and typing in VERSION, I found ‚ÄúPMA_VERSION: 4.6.6‚Äù. I‚Äôll check to see if we have a vulnerability for this version.</p>

<div class="terminal-block">
<a href="images/internal/it9.png" target="_blank">
<img src="images/internal/it9.png">
</a>
</div>

<p>These are the only ones noted on a ‚Äú4.0‚Äù level, none being 4.6.6. We can run a quick google search to see if there's an exploit as well.</p>

<p>After a lengthy search, I couldn‚Äôt find anything reliable. Since phpmyadmin normally has a /setup directory, let's see if we can reach it.</p>

<p>Unreachable, but it exists, good to hear.</p>

<p>I‚Äôll run ffuf once more, on /phpmyadmin, to see if there's any more hidden directories behind this mystical login page.</p>

<div class="terminal-block">
<a href="images/internal/it10.png" target="_blank">
<img src="images/internal/it10.png">
</a>
</div>

<p>We got a few more! I‚Äôll save you the trouble of going through all of them, and just do it myself.</p>

<p>Lovely, no access to any of them. The only one that stands out to me is /setup for now, as it‚Äôs asking for a basic HTTP login POST form. We NEED these credentials.</p>

<p>After being distracted for too long on PMA and coming to the conclusion that we need to do something beforehand, I decided to run ffuf on /blog.</p>

<div class="terminal-block">
<a href="images/internal/it11.png" target="_blank">
<img src="images/internal/it11.png">
</a>
</div>

<p>Aha, more content!</p>

<p>After going to /wp-login.php, I inspected the page source and found that the website is being hosted on internals.thm. We need to add this to our /etc/hosts file to get the correct page output.</p>

<p>Also noted from the page source, this login portal is using Wordpress 5.4.2.</p>

<p>Before searching for vulnerabilities, we need to enumerate users.</p>

<p>I used a funny little command for WordPress that Identifies users, service version, and some vulnerabilities!</p>

<div class="terminal-block">
<a href="images/internal/it12.png" target="_blank">
<img src="images/internal/it12.png">
</a>
</div>

<p>Here‚Äôs some good stuff we can note from this</p>

<div class="terminal-block">
<a href="images/internal/it13.png" target="_blank">
<img src="images/internal/it13.png">
</a>
</div>

<p>After a quick google search on xmlrpc, I got this definition</p>

<p>‚ÄúXML-RPC is a Remote Procedure Call (RPC) protocol that allows a client to call functions or methods on a remote server using HTTP as the transport layer and XML to encode the data. It is a simple, structured, and language-independent way to exchange data between applications, commonly used in API design, data integration, and notably within WordPress.‚Äù</p>

<p>Hmmm, calling functions or methods on a remote server‚Ä¶ interesting</p>

<div class="terminal-block">
<a href="images/internal/it14.png" target="_blank">
<img src="images/internal/it14.png">
</a>
</div>

<p>We can check that out</p>

<p>After reading, I discovered that it‚Äôs just a basic webpage for some manager WordPress uses, nothing interesting.</p>

<div class="terminal-block">
<a href="images/internal/it15.png" target="_blank">
<img src="images/internal/it15.png">
</a>
</div>

<p>Alright, lets move on and try bruteforcing now that we have a username.</p>

<p>I had to use ChatGPT for the command on this part as I‚Äôm unfamiliar with XML-RPC, so here‚Äôs the script.</p>

<div class="terminal-block">
<a href="images/internal/it16.png" target="_blank">
<img src="images/internal/it16.png">
</a>
</div>

<div class="terminal-block">
<a href="images/internal/it17.png" target="_blank">
<img src="images/internal/it17.png">
</a>
</div>

<p>After giving it some time, we found a login! I spent some time enumerating other things while this script ran, but nothing really stood out to me. Let‚Äôs see where this login takes us.</p>

<div class="terminal-block">
<a href="images/internal/it18.png" target="_blank">
<img src="images/internal/it18.png">
</a>
</div>

<p>Looks like we have a plugins page, nice. Maybe we can exploit this to spawn a user shell.</p>

<p>Alrighty well after trying to upload a .php file, and a ZIP file, looks like they have it pretty locked down. Let me browse and see if we can find anything else.</p>

<p>Okay, after some further snooping, I went to theme editor. Here, we can find a .css, and a .php file that we can both edit. SINCE we can edit the .php, I can probably pop a shell from this.</p>

<p>Let me start a listener</p>

<div class="terminal-block">
<pre><code class="language-bash">
nc -lvnp 4444
</code></pre>
</div>

<p>After that, I made a shell with Reverse Shell Generator, and completely appended the functions.php file with my reverse shell. Now we‚Äôre in, but the page is broken and unrecoverable lol.</p>

<p>Let us spawn a python shell</p>

<div class="terminal-block">
<pre><code class="language-bash">
python3 -c 'import pty; pty.spawn("/bin/bash")'
</code></pre>
</div>

<div class="terminal-block">
<a href="images/internal/it19.png" target="_blank">
<img src="images/internal/it19.png">
</a>
</div>

<p>Alright so it looks like there's permissions that we do not have. We need some credentials. We should read the config file that we enumerated earlier, this will probably have some credentials stored inside it.</p>

<div class="terminal-block">
<pre><code class="language-bash">
cat /var/www/html/wordpress/wp-config.php
</code></pre>
</div>

<div class="terminal-block">
<a href="images/internal/it20.png" target="_blank">
<img src="images/internal/it20.png">
</a>
</div>

<p>Okay so we have SQL login credentials. Great, lets see if we can switch users to the one we didn‚Äôt have permissions for with the credentials we found in the config file. Lets load up SQL with the credentials.</p>

<div class="terminal-block">
<a href="images/internal/it21.png" target="_blank">
<img src="images/internal/it21.png">
</a>
</div>

<p>Alright now that we‚Äôre in SQL, lets see if we can get any hashes.</p>

<div class="terminal-block">
<a href="images/internal/it22.png" target="_blank">
<img src="images/internal/it22.png">
</a>
</div>

<p>Beautiful, we have a hash for the admin user. We need to crack this hash so we can potentially get escalated privileges. I was gonna write steps on how to crack this but I then realized that this is just the same password we found earlier. Moving on, lets check /opt for any hidden files.</p>

<div class="terminal-block">
<a href="images/internal/it23.png" target="_blank">
<img src="images/internal/it23.png">
</a>
</div>

<p>wp-save.txt, interesting. Lets read this and see if it has anything important stored inside it.</p>

<div class="terminal-block">
<a href="images/internal/it24.png" target="_blank">
<img src="images/internal/it24.png">
</a>
</div>

<p>Bingo. We found a password for the aurbeanna user. Lets switch to her user account and priv esc further.</p>

<div class="terminal-block">
<a href="images/internal/it25.png" target="_blank">
<img src="images/internal/it25.png">
</a>
</div>

<p>BEAUTIFULLLLLL. Now we need root üòõ What‚Äôs jenkins.txt?</p>

<div class="terminal-block">
<a href="images/internal/it26.png" target="_blank">
<img src="images/internal/it26.png">
</a>
</div>

<p>Put in easy terms since I don‚Äôt quite understand what Jenkins is yet, jenkins is ‚Äúbasically a web-based automation engine.‚Äù</p>

<p>We need to port forward jenkins to ourself, so lets run this command to do so.</p>

<div class="terminal-block">
<pre><code class="language-bash">
ssh -L 8080:172.17.0.2:8080 aubreanna@internal.thm
</code></pre>
</div>

<p>Next we enter aubreannas password. Pop open a localhost page on port 8080, and we should have a Jenkins login portal. http://localhost:8080</p>

<div class="terminal-block">
<a href="images/internal/it27.png" target="_blank">
<img src="images/internal/it27.png">
</a>
</div>

<p>I‚Äôm gonna start off here with some bruteforcing and see if we get anywhere.</p>

<p>Using our handy dandy OWASP ZAP, I can open a proxy configured to ZAP and load up the page again.</p>

<div class="terminal-block">
<a href="images/internal/it28.png" target="_blank">
<img src="images/internal/it28.png">
</a>
</div>

<p>Now it should be under sites. Lets send in some random credentials to the login page and view the post request.</p>

<p>Attack > Fuzz</p>

<div class="terminal-block">
<a href="images/internal/it29.png" target="_blank">
<img src="images/internal/it29.png">
</a>
</div>

<p>We‚Äôre gonna try using ‚Äúadmin‚Äù as the username and see if we can get anywhere. I‚Äôm gonna select the ‚Äúadmin‚Äù field after j_password, and add a file to bruteforce with.</p>

<div class="terminal-block">
<a href="images/internal/it30.png" target="_blank">
<img src="images/internal/it30.png">
</a>
</div>

<p>After adding rockyou.txt, we start fuzzing.</p>

<p>From here, I sorted all the files by size, and found one that stood out from the others. This one right here, 310 bytes, different from all the rest.</p>

<div class="terminal-block">
<a href="images/internal/it31.png" target="_blank">
<img src="images/internal/it31.png">
</a>
</div>

<p>Lets try this for the password</p>

<div class="terminal-block">
<a href="images/internal/it32.png" target="_blank">
<img src="images/internal/it32.png">
</a>
</div>

<p>And we‚Äôre in! Nice.</p>

<p>I‚Äôm gonna look around this page and come back when I find something.</p>

<p>Alright, after some time I found a ‚ÄúScript Console‚Äù where we can upload arbitrary scripts and run them. We can use this to our advantage and pop a shell most likely.</p>

<p>Lets start another listener for this! nc -lvnp 1234</p>

<p>I used Reverse Shell Generator and selected Groovy, as this script console uses groovy, to get a reverse shell script for this part.</p>

<div class="terminal-block">
<a href="images/internal/it33.png" target="_blank">
<img src="images/internal/it33.png">
</a>
</div>

<p>Great. Not root, but we‚Äôre further in.</p>

<p>After nearly an hour of searching through this god forbidden shell, I remembered that we checked /opt in an earlier step, so I decided to do so again.</p>

<p>Inside of /opt, we find note.txt (yes, to put it into perspective of what i was going through, i included some lines to show you how bad i was struggling here LOL)</p>

<div class="terminal-block">
<a href="images/internal/it34.png" target="_blank">
<img src="images/internal/it34.png">
</a>
</div>

<p>It‚Äôs beautiful. Brings a tear to my eye quite frankly.</p>

<p>Let me ssh into root.</p>

<div class="terminal-block">
<a href="images/internal/it35.png" target="_blank">
<img src="images/internal/it35.png">
</a>
</div>

<p>We did it! After quite some time (7 hours, yes, 7 hours) I found both flags.</p>

<p>This challenge exposed me to a lot of new material, things I had never seen before. I had a blast figuring things out along the way, although I don‚Äôt think I ever want to look at a computer screen again for at least a week lol.</p>

<p>I hope this writeup was of some use, visit my website @probablymiller.com and shoot me an email for any inquiries.</p>

<p>It‚Äôs time I get some sleep now, goodnight.</p>

<hr class="divider">

<div style="margin-top:40px;">
<a href="index.html" class="btn-secondary">‚Üê Back to Writeups</a>
</div>

</div>
</body>
</html>
